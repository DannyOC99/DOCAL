---
title: "Homework 7: Mapping 500 Gas Stations  and Philidelphia Area Crimes to Demonstrate Knowledge of Plotting on a Map"
author: "Daniel OCallaghan"
date: ""
output:
  html_document: 
    toc: yes
    toc_depth: 4
    toc_float: yes
    fig_width: 6
    fig_caption: yes
    number_sections: yes
    toc_collapsed: yes
    code_folding: hide
    code_download: yes
    smooth_scroll: true
    theme: readable
  pdf_document: 
    toc: yes
    toc_depth: 4
    fig_caption: yes
    number_sections: yes
    fig_width: 5
    fig_height: 4
---
<style type="text/css">

/* Table of content - navigation */
div#TOC li {
    list-style:none;
    background-color:black;
    background-image:none;
    background-repeat:none;
    background-position:0;
    font-family: Arial, Helvetica, sans-serif;
    color: lightblue;
}

h1.title {
  font-size: 24px;
  color: Navy;
  text-align: center;
}

h4.author { /* Header 4 - and the author and data headers use this too  */
    font-size: 18px;
  font-family: "Times New Roman", Times, serif;
  color: blue;
  text-align: center;
}
h4.date { /* Header 4 - and the author and data headers use this too  */
  font-size: 18px;
  font-family: "Times New Roman", Times, serif;
  color: blue;
  text-align: center;
}
h1 { /* Header 3 - and the author and data headers use this too  */
    font-size: 22px;
    font-family: "Times New Roman", Times, serif;
    color: blue;
    text-align: center;
}
h2 { /* Header 3 - and the author and data headers use this too  */
    font-size: 18px;
    font-family: "Times New Roman", Times, serif;
    color: Navy;
    text-align: left;
}

h3 { /* Header 3 - and the author and data headers use this too  */
    font-size: 15px;
    font-family: "Times New Roman", Times, serif;
    color: Navy;
    text-align: left;
}

h4 { /* Header 4 - and the author and data headers use this too  */
    font-size: 18px;
    font-family: "Times New Roman", Times, serif;
    color: Navy;
    text-align: left;
}
</style>

```{r setup, include=FALSE}
# code chunk specifies whether the R code, warnings, and output 
# will be included in the output files.
if (!require("tidyverse")) {
   install.packages("tidyverse")
   library(tidyverse)
}
if (!require("knitr")) {
   install.packages("knitr")
   library(knitr)
}
if (!require("plotly")) {
   install.packages("plotly")
   library(plotly)
}
if (!require("gapminder")) {
   install.packages("gapminder")
   library(gapminder)
}
if (!require("RCurl")) {
    install.packages("RCurl")             # Install RCurl package
    library("RCurl")
}
if (!require("colourpicker")) {
    install.packages("colourpicker")              
    library("colourpicker")
}
if (!require("gganimate")) {
    install.packages("gganimate")              
    library("gganimate")
}
if (!require("gifski")) {
    install.packages("gifski")              
    library("gifski")
}
if (!require("magick")) {
    install.packages("magick")              
    library("magick")
}
if (!require("grDevices")) {
    install.packages("grDevices")              
    library("grDevices")
}
if (!require("leaflet")) {
    install.packages("leaflet")              
    library("leaflet")
}
if (!require("maps")) {
    install.packages("maps")              
    library("maps")
}
if (!require("htmltools")) {
    install.packages("htmltools")              
    library("htmltools")
}
if (!require("leaflegend")) {
    install.packages("leaflegend")              
    library("leaflegend")
}
if (!require("geojsonio")) {
    install.packages("geojsonio")              
    library("geojsonio")
}
if (!require("stringi")) {
    install.packages("stringi")              
    library("stringi")
}
if (!require("RColorBrewer")) {
    install.packages("RColorBrewer")              
    library("RColorBrewer")
}
if (!require("tigris")) {
    install.packages("tigris")              
    library("tigris")
}
if (!require("leafpop")) {
    install.packages("leafpop")              
    library("leafpop")
}
if (!require("leafem")) {
    install.packages("leafem")              
    library("leafem")
}
if (!require("tmap")) {
    install.packages("tmap")              
    library("tmap")
}
if (!require("tmaptools")) {
    install.packages("tmaptools")              
    library("tmaptools")
}
if (!require("readxl")) {
    install.packages("readxl")              
    library("readxl")
}
# knitr::opts_knit$set(root.dir = "C:/Users/75CPENG/OneDrive - West Chester University of PA/Documents")
# knitr::opts_knit$set(root.dir = "C:\\STA490\\w05"
knitr::opts_chunk$set(echo = TRUE,       
                      warning = FALSE,   
                      result = TRUE,   
                      message = FALSE,
                      comment = NA)
```



# Bringing in and Modifying the dataset

To work with the Countries dataset, we will be bringing in Country Info from my github. We will also be limiting it to 2015 for our plot of life expectancy and income in 2015. 
```{r dataset}
POC<-read.csv(file="https://dannyoc99.github.io/DOCAL/dataset/POC.csv")
POC500<-sample_n(POC,500)
pocprev<-POC500[7:9]
```

# A look into the dataset

```{r data}
DT::datatable(pocprev, fillContainer = FALSE, options = list(pageLength = 11))
```



# The 500 Gas Stations Chosen

```{r plot}
g <- list(      scope = 'usa',
           projection = list(type = 'albers usa'),
             showland = TRUE,
            landcolor = toRGB("gray95"),
         subunitcolor = toRGB("gray85"),
         countrycolor = toRGB("gray85"),
         countrywidth = 0.5,
         subunitwidth = 0.5
       )
###
fig <- plot_geo(POC500, lat = ~ycoord, lon = ~xcoord) %>% 
  add_markers( text = ~paste(STATE, "<br>",
                           "County:", county, "<br>",
                           "Address", ADDRESS, "<br>",
                           "City:", CITY, "<br>",
                           "Zip:", ZIPnew),
              color = ~truckstop_flag, 
              symbol = "circle", 
              hoverinfo = "text")   %>% 
  layout( title = '500 Gas Stations in the United States', 
          geo = g,
          legend = list(title = list(text = "<b>Truckstop Y/N</b>"))) 

fig
```

Within our data, we wanted to take a look at 500 random gas stations within the united States. Within our sample, a large majority of our sample was on the east coast, west coast, and Texas. This makes a lot of sense, because when you consider the population densities of the United States, these would have the highest densities, and thus would require more gas stations. To have the graph give more information, I included whether or not a gas station is also a truck stop as a color. Looking at this information, we see that many of the midwest gas stations are truck stops, but most of the coastal states are just gas stations. This also makes sense as many of the mid western states do not have a ton of people living in them, so they are primarily used for travel requiring the gas stations to be truck stops.


# Preparing Crime Statistics Data

```{r crime}
crime_raw<-POC<-read.csv(file="https://dannyoc99.github.io/DOCAL/dataset/PhillyCrimeSince2015.csv")
crime2023<-mutate(crime_raw,year=format(as.Date(date,format="%m/%d/%Y"),"%Y"))%>%filter(year==2023)
```

# Mapping Philidelphia 2015 Crimes

```{r graphing philly}
g <- list(      scope = 'usa',
           projection = list(type = 'albers usa'),
             showland = TRUE,
            landcolor = toRGB("gray95"),
         subunitcolor = toRGB("gray85"),
         countrycolor = toRGB("gray85"),
         countrywidth = 0.5,
         subunitwidth = 0.5,
         scale=.3,
         center_lat=-75,
         center_long=40
       )

fig <- plot_geo(crime2023, lat = ~lat, lon = ~lng) %>% 
  add_markers( text = ~paste("Fatal:",fatal, "<br>",
                            "Street:",street_name, "<br>",
                           "Zip:", zip_code, "<br>",
                           "Neighborhood", neighborhood, "<br>",
                           "Sex:", sex, "<br>",
                           "Race:", race),
              color = ~fatal, 
              symbol = "circle", 
              hoverinfo = "text")   %>% 
  layout( title = '2023 Philidelphia Area Crimes', 
          geo = g,
          legend = list(title = list(text = "<b>Fatality Y/N</b>")),
          xaxis = list(range = list(-77, -74)),
yaxis = list(range = list(44, 46))) 

fig

```