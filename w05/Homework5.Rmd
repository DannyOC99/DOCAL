---
title: "Homework 5: Modifying and Combining Datasets to Plot Life-Expectancy vs GDP per Capita"
author: "Daniel OCallaghan"
date: ""
output:
  html_document: 
    toc: yes
    toc_depth: 4
    toc_float: yes
    fig_width: 6
    fig_caption: yes
    number_sections: yes
    toc_collapsed: yes
    code_folding: hide
    code_download: yes
    smooth_scroll: true
    theme: readable
  pdf_document: 
    toc: yes
    toc_depth: 4
    fig_caption: yes
    number_sections: yes
    fig_width: 5
    fig_height: 4
---
<style type="text/css">

/* Table of content - navigation */
div#TOC li {
    list-style:none;
    background-color:black;
    background-image:none;
    background-repeat:none;
    background-position:0;
    font-family: Arial, Helvetica, sans-serif;
    color: lightblue;
}

h1.title {
  font-size: 24px;
  color: Navy;
  text-align: center;
}

h4.author { /* Header 4 - and the author and data headers use this too  */
    font-size: 18px;
  font-family: "Times New Roman", Times, serif;
  color: blue;
  text-align: center;
}
h4.date { /* Header 4 - and the author and data headers use this too  */
  font-size: 18px;
  font-family: "Times New Roman", Times, serif;
  color: blue;
  text-align: center;
}
h1 { /* Header 3 - and the author and data headers use this too  */
    font-size: 22px;
    font-family: "Times New Roman", Times, serif;
    color: blue;
    text-align: center;
}
h2 { /* Header 3 - and the author and data headers use this too  */
    font-size: 18px;
    font-family: "Times New Roman", Times, serif;
    color: Navy;
    text-align: left;
}

h3 { /* Header 3 - and the author and data headers use this too  */
    font-size: 15px;
    font-family: "Times New Roman", Times, serif;
    color: Navy;
    text-align: left;
}

h4 { /* Header 4 - and the author and data headers use this too  */
    font-size: 18px;
    font-family: "Times New Roman", Times, serif;
    color: Navy;
    text-align: left;
}
</style>

```{r setup, include=FALSE}
options(repos = list(CRAN="http://cran.rstudio.com/"))
if (!require("tidyverse")) {
   install.packages("tidyverse")
   library(tidyverse)
}
if (!require("knitr")) {
   install.packages("knitr")
   library(knitr)
}
if (!require("cowplot")) {
   install.packages("cowplot")
   library(cowplot)
}
if (!require("latex2exp")) {
   install.packages("latex2exp")
   library(latex2exp)
}
if (!require("plotly")) {
   install.packages("plotly")
   library(plotly)
}
if (!require("gapminder")) {
   install.packages("gapminder")
   library(gapminder)
}
if (!require("png")) {
    install.packages("png")             # Install png package
    library("png")
}
if (!require("RCurl")) {
    install.packages("RCurl")           # Install RCurl package
    library("RCurl")
}
if (!require("colourpicker")) {
    install.packages("colourpicker")              
    library("colourpicker")
}
if (!require("gifski")) {
    install.packages("gifski")              
    library("gifski")
}
if (!require("magick")) {
    install.packages("magick")              
    library("magick")
}
if (!require("grDevices")) {
    install.packages("grDevices")              
    library("grDevices")
}
### ggplot and extensions
if (!require("ggplot2")) {
    install.packages("ggplot2")              
    library("ggplot2")
}
if (!require("gganimate")) {
    install.packages("gganimate")              
    library("gganimate")
}
if (!require("ggridges")) {
    install.packages("ggridges")              
    library("ggridges")
}
if (!require("graphics")) {
    install.packages("graphics")              
    library("graphics")
}

knitr::opts_chunk$set(echo = TRUE,       
                      warning = FALSE,   
                      result = TRUE,   
                      message = FALSE,
                      comment = NA)
```



# Modifying the dataset

## Bringing in the datasets 

For this portion of a dataset manipulation We will be bringing all of the dataets necessary from my github repository

```{r dataset}
income<-read.csv(file="https://dannyoc99.github.io/DOCAL/dataset/income_per_person.csv")
life.expectancy<-read.csv(file="https://dannyoc99.github.io/DOCAL/dataset/life_expectancy_years.csv")
region<-read.csv(file="https://dannyoc99.github.io/DOCAL/dataset/countries_total.csv")
poptot<-read.csv(file="https://dannyoc99.github.io/DOCAL/dataset/population_total.csv")
```

## Turning Latitudinal Data into Longitudinal

Many of our datasets were brought in a wide format with years being columns. We want all of our years to be in one column, so we will manipulate our wide datasets into a long dataset. We will also use this opportunity to limit the region dataset to only include variables we care about. The income dataset ends up with 3 variables country, year, and gdpPercap with 42,267 Country-Year combinations. The Life Expectancy dataset ends up as a dataset with 3 variables: country, year, and lifeExp with 40,437 Country-Year combinations The Population Total dataset ends up as a dataset of 3 variables: country, year, and pop with 42,705 Country-Year Combinations. The region dataset was also limited to have 2 variables: Name and Continent with 248 countries.


```{r missing}
income.long<-income %>%
  gather(key = "Year",
         value = "gdpPercap",
         - geo,          
         na.rm = TRUE)   
incomeperperson <- income.long %>%
                      mutate(year = substr(Year,2,5)) %>%
                      select(-Year) %>%
                      rename(Country=geo)
life.expectancy.long<-life.expectancy %>%
  gather(key = "Year",
         value = "lifeExp",
         - geo,          
         na.rm = TRUE)  
LifeExpectancy <- life.expectancy.long %>%
                      mutate(year = substr(Year,2,5)) %>%
                      select(-Year) %>%
                      rename(Country=geo)
poptot.long<-poptot %>%
  gather(key = "Year",
         value = "pop",
         - geo,          
         na.rm = TRUE)  
Population <- poptot.long %>%
                      mutate(year = substr(Year,2,5)) %>%
                      select(-Year) %>%
                      rename(Country=geo)
region.need<-region[c(1,6)] %>% rename(continent=region)
```

## Meging Datasets

With all of our datasets in proper format, we now what to combine our datasets. For the merging of income and life expectancy we will be doing a full join, as there is a country that exists in Income per person that does not exist in life expectancy. For the others we will be doing a left join as we only care about the contries that are a part of the LifeExpIncom dataset. This leaves us with the LifeExpIncom dataset having 4 variables Country, year, GDPPercap, and LifeExp with 42,267 observations  The proceeding left join addings on continent which adds one more variable to the lifeexpincom dataset, ultimately leading to a final dataset of 42,267 observations and 5 variables: country, year, GDPPercap, LifeExp, Pop, and Continent.

```{r merge}
LifeExpIncom=merge(x = incomeperperson, y = LifeExpectancy, by.x= c("Country","year"),by.y= c("Country","year"), all = TRUE)
LifeExpIncom.Region=merge(x = LifeExpIncom, y = region.need, by.x= c("Country"),by.y= c("name"), all.x  = TRUE)
LifeExpIncomPlot<-merge(x = LifeExpIncom.Region, y = Population, by.x= c("Country","year"),by.y= c("Country","year"), all.x  = TRUE)
write_csv(LifeExpIncomPlot,"Country Info.csv")
```

## Limited to 2001

To set up for our graph we will be limiting oru dataset to only include the year 2000. Whilst the homework asked us to name our final dataset 2000data, this is not a R viable name as datasets cannot start with numbers, therefore we will name this dataset data2000. Data2000 has a dataset of 193 Countries, with 6 variables included country, year, lifeexp, gdpPercap, Continent, and pop.

```{r filter}
data2000<-filter(LifeExpIncomPlot,year=="2000")
  
```

# Dataset used for graph

Here is a look at the dataset we created
```{r data}
DT::datatable(data2000, fillContainer = FALSE, options = list(pageLength = 11))
```

# Graphing GDP Per capita vs Life Expectancy by Continent and Population Size 

```{r plot}
myplot.theme <- function() {
  theme(
    plot.title = element_text(face = "bold", 
                              size = 10,
                              family = "sans", 
                              color = "darkred",
                              hjust = 0.5), # left(0),right(1)
    # add border 1)
    panel.border = element_rect(colour = "blue", 
                                fill = NA, 
                                linetype = 2),
    # color background 2)
    panel.background = element_rect(fill = "aliceblue"),
    # modify grid 3)
    panel.grid.major.x = element_line(colour = "steelblue", 
                                      linetype = 3, 
                                      size = 0.5),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.y =  element_line(colour = "steelblue", 
                                       linetype = 3, 
                                       size = 0.5),
    panel.grid.minor.y = element_blank(),
    # modify text, axis and colour 4) and 5)
    axis.text = element_text(colour = "steelblue", 
                             face = "italic", 
                             family = "Times New Roman"),
    axis.title = element_text(colour = "steelblue", 
                              family = "Times New Roman"),
    axis.ticks = element_line(colour = "steelblue"),
    # legend at the bottom 6)
    legend.position = "bottom",
    legend.key.size = unit(0.6, 'cm'), #change legend key size
    legend.key.height = unit(0.6, 'cm'), #change legend key height
    legend.key.width = unit(0.6, 'cm'), #change legend key width
    legend.title = element_text(size=5), #change legend title font size
    legend.text = element_text(size=5)) #change legend text font size
}
plot.life<-data2000$lifeExp
plot.pop<-data2000$pop
plot.region<-data2000$continent
plot.gdp<-data2000$gdpPercap
ggplot(data2000, aes(x = plot.life, y = plot.gdp, 
                              color = factor(plot.region), 
                              size = plot.pop)) +
             geom_point(alpha = 0.5) +
             scale_color_manual(values=c("#000000", "#E69F00", "#56B4E9", "#009E73","#F0E442", "#0072B2")) +
             labs(
                 x = "Life Expectancy",
                 y = "GDP per Capita",
                 ## Color and size of labels
                 color = "Continent:",
                 size = "Population",
                 title = "Association between GDP per Capita and Life Expectancy in the year 2000") +
             myplot.theme()

```

Here we have a graph of GDP per Capita vs Life Expectancy during the year 2000. Additionally we have factored in the Continent of the countries by using color and the population sizes by using it as a basis for the size of the points. To make the graph color-blind friendly, we used Wong's pallet. Looking at the graph we get to see many different aspects of how Life Expectancy effects GDP Per Capita as any of the high GDP countries, have a higher life expectancy. Additionally, the color allows us to notice that the African countries are typically the ones that have a lower life expectancy and a lower GDP Per capita. We can also see that Europe and Asia make up a lot of the higher Populations, Life Expectancies, and GDP Per Capita. Finally, the graph lets us see that the GDP Per Capita has a very large margin, as most of the countries do not even make it to the first tick mark of the graph showing many outlier countries in terms of GDP.
